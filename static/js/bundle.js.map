{"version":3,"file":"bundle.js","sources":["../src/index.js"],"sourcesContent":["const textShiftModifier = 0.3; // relative to the media\nconst deadzone = 0.3; // in screens\nconst wordsInterval = 2000;\nconst isMobile = () => window.innerWidth < 1024;\n\nconst mediaShiftModifier = 1;\n\nlet activeWord = null;\nconst words = Array.from(document.querySelectorAll('.dynamic-word p'));\n\nconst changeWord = id => {\n  if (words[activeWord]) {\n    words[activeWord].classList.remove('active');\n  }\n  words[id].classList.add('active');\n\n  activeWord = id;\n};\n\nconst initDynamicWords = () => {\n  changeWord(0);\n};\n\nconst startDynamicWords = () => {\n  setInterval(() => {\n    changeWord((activeWord + 1) % words.length);\n    console.log(1);\n  }, wordsInterval);\n};\n\nconst textSlides = Array.from(document.querySelectorAll('.text-content'));\nconst mediaSlides = Array.from(document.querySelectorAll('.media-content'));\nconst space = document.querySelector('.space');\nconst totalSlides = Math.max(textSlides.length, mediaSlides.length);\n\nlet activeSlide = null;\nconst activateSlide = id => {\n  console.log(id);\n  if (id === activeSlide) {\n    return;\n  }\n\n  if (mediaSlides[activeSlide]) {\n    mediaSlides[activeSlide].classList.remove('active');\n\n    const video = mediaSlides[activeSlide].querySelector('video');\n\n    video.pause();\n  }\n\n  if (id !== null) {\n    mediaSlides[id].classList.add('active');\n\n    const video = mediaSlides[id].querySelector('video');\n\n    video.play();\n  }\n\n  if (textSlides[activeSlide]) {\n    textSlides[activeSlide].classList.remove('active');\n  }\n\n  if (id != null) {\n    textSlides[id].classList.add('active');\n  }\n\n  activeSlide = id;\n}\n\nconst transformShift = (raw, modifier) => {\n  const premodified = (() => {\n    const deadzoneStart = (1 - deadzone) / 2;\n\n    if (raw < deadzoneStart) {\n      return raw / deadzoneStart; // return 0..1 for the start of the function\n    } else if (raw > deadzoneStart + deadzone) {\n      return (1 - raw) / deadzoneStart; // return 1..0 for the end of the function\n    } else {\n      return 1; // flat 1 in the middle of the function\n    }\n  })();\n\n  return 1 - modifier + premodified * modifier;\n}\n\nconst slidesContainer = document.querySelector('.slides');\n\nconst shiftSlides = (currentSlide, currentScroll) => {\n  if (currentSlide === null) {\n    return\n  }\n\n  // Reverse for even slides (slides already moved by default, so moving negative is actually moving at its original place)\n  const sign = currentSlide % 2 === 1 ? 1 : -1;\n\n  const rawShift = (currentScroll % window.innerHeight) / window.innerHeight;\n\n  const mediaShiftDistance = (slidesContainer.clientWidth - mediaSlides[currentSlide].clientWidth) / 2;\n  const textShiftDistance = (slidesContainer.clientWidth - textSlides[currentSlide].clientWidth) / 2;\n\n  // Media goes opposite side\n  const mediaShift = -sign * transformShift(rawShift, mediaShiftModifier) * mediaShiftDistance;\n  const textShift = sign * transformShift(rawShift, textShiftModifier) * textShiftDistance;\n  const opacityShift = transformShift(rawShift, 1);\n\n  mediaSlides[currentSlide].style.transform = `translateX(${mediaShift}px)`;\n  textSlides[currentSlide].style.transform = `translateX(${textShift}px)`;\n\n  textSlides[currentSlide].style.opacity = opacityShift;\n}\n\nconst resizeSpace = () => {\n  // Compensate deadzone-altered initial scroll\n  space.style.height = `${window.innerHeight * (totalSlides - 1) - window.innerHeight * deadzone}px`;\n}\n\nconst watchScrollMedia = media => {\n  const checkMediaPosition = () => {\n    media.forEach(el => {\n      const onPage = (\n        el.getBoundingClientRect().top < window.innerHeight &&\n        el.getBoundingClientRect().bottom > 0\n      );\n\n      if (onPage) {\n        el.play()\n          .catch(reason => console.log('Playback failed: %o', reason));\n      } else {\n        el.pause();\n      }\n    });\n  };\n\n  window.addEventListener('scroll', checkMediaPosition);\n  window.addEventListener('resize', checkMediaPosition);\n  checkMediaPosition();\n}\n\nconst videoPlayback = () => {\n  const pageMedia = Array.from(document.querySelectorAll('.page-media'));\n  const slidesMedia = Array.from(document.querySelectorAll('.media-content video'));\n\n  if (isMobile()) {\n    watchScrollMedia(slidesMedia.concat(pageMedia));\n  } else {\n    watchScrollMedia(pageMedia);\n  }\n}\n\nconst handleScroll = () => {\n  const minScroll = window.innerHeight * (0.5 + deadzone / 2);\n  const maxScroll = window.innerHeight * totalSlides - minScroll;\n\n  let currentScroll = document.documentElement.scrollTop + minScroll;\n\n  // Max scroll that slides will react to\n  const limitedScroll = Math.min(\n    currentScroll,\n    maxScroll\n  );\n\n  // Scroll is past the limit, compensate its max scroll by the scroll distance last slide was viewport-fixed\n  if (currentScroll > limitedScroll) {\n    currentScroll = currentScroll - (1 - deadzone) / 2 * window.innerHeight;\n  }\n\n  // Next slide to be selected\n  let currentSlide = Math.floor(currentScroll / window.innerHeight);\n\n  if (currentSlide > totalSlides - 1) {\n    currentSlide = null\n  }\n\n  activateSlide(currentSlide);\n  shiftSlides(currentSlide, limitedScroll);\n}\n\nconst addWindowEvents = () => {\n  window.addEventListener('scroll', () => {\n    if (isMobile()) {\n      return;\n    }\n\n    handleScroll();\n  });\n\n  window.addEventListener('resize', () => {\n    if (isMobile()) {\n      return;\n    }\n\n    resizeSpace();\n    handleScroll();\n  });\n}\n\nconst loadMedia = () => {\n  const sources = Array.from(document.querySelectorAll('source[data-src]'));\n  const slideVideos = Array.from(document.querySelectorAll('.slides video'));\n\n  sources.map(s => s.src = s.getAttribute('data-src'));\n\n  const loadVideos = slideVideos.map(el => new Promise(res => {\n    el.addEventListener('loadedmetadata', res);\n    el.addEventListener('loadeddata', res);\n    el.load();\n  }))\n\n  return Promise.race([\n    Promise.all(loadVideos).then(() => 1),\n    new Promise(res => setTimeout(res, 5000)).then(() => 2)\n  ])\n};\n\nconst hideLoader = () => {\n  document.querySelector('.loader').classList.add('done');\n\n  if (!isMobile()) {\n    document.querySelector('.root').classList.add('initialized');\n  }\n};\n\nconst minTimer = new Promise(res => setTimeout(res, 1000));\n\nconst addFormEvents = () => {\n  const formEl = document.querySelector('.form');\n  const showFormButtons = Array.from(document.querySelectorAll('.form-show-button'));\n  const hideFormButtons = Array.from(document.querySelectorAll('.form-hide-button'));\n\n  const showForm = () => {\n    formEl.classList.add('open');\n    setTimeout(() => {\n      formEl.querySelector('input').focus();\n    }, 100);\n  }\n\n  const hideForm = () => {\n    formEl.classList.remove('open');\n  }\n\n  hideFormButtons.map(el => el.addEventListener('click', hideForm));\n  showFormButtons.map(el => el.addEventListener('click', showForm));\n\n  formEl.addEventListener('click', e => {\n    if (e.target === e.currentTarget) {\n      hideForm();\n    }\n  });\n\n  const select = document.querySelector('select');\n  const selectValue = document.querySelector('.select-value');\n\n  const setSelectValue = value => {\n    selectValue.innerHTML = value;\n  }\n\n  select.addEventListener('change', e => {\n    setSelectValue(e.target.options[e.target.selectedIndex].innerHTML);\n  });\n\n  const form = document.querySelector('.beta-access-form');\n\n  form.addEventListener('submit', e => {\n    e.preventDefault();\n\n    // Form action here\n\n    // form.checkValidity();\n\n    form.classList.add('done');\n  });\n};\n\nconst headerTheming = () => {\n  const plans = document.querySelector('.plans');\n  const header = document.querySelector('header');\n\n  const handleScroll = () => {\n    if (isMobile()) {\n      return;\n    }\n\n    const overPlans = (\n      plans.getBoundingClientRect().top - header.clientHeight / 2 < 0 &&\n      plans.getBoundingClientRect().bottom - header.clientHeight / 2 > 0\n    );\n\n    if (overPlans) {\n      header.classList.add('over-plans');\n    } else {\n      header.classList.remove('over-plans');\n    }\n  };\n\n  window.addEventListener('scroll', handleScroll);\n  window.addEventListener('resize', handleScroll);\n  handleScroll();\n};\n\nPromise\n  .all([\n    loadMedia(),\n    minTimer\n  ])\n  .finally(() => {\n    if (!isMobile()) {\n      document.documentElement.scrollTop = 0;\n    }\n    handleScroll();\n    addWindowEvents();\n    addFormEvents();\n    headerTheming();\n    hideLoader();\n\n    videoPlayback();\n\n    startDynamicWords();\n  });\n\nresizeSpace();\ninitDynamicWords();\n"],"names":["isMobile","window","innerWidth","activeWord","words","Array","from","document","querySelectorAll","changeWord","id","classList","remove","add","textSlides","mediaSlides","space","querySelector","totalSlides","Math","max","length","activeSlide","transformShift","raw","modifier","deadzoneStart","slidesContainer","resizeSpace","style","height","innerHeight","watchScrollMedia","media","checkMediaPosition","forEach","el","getBoundingClientRect","top","bottom","play","catch","reason","console","log","pause","addEventListener","handleScroll","minScroll","maxScroll","currentScroll","documentElement","scrollTop","limitedScroll","min","currentSlide","floor","sign","rawShift","mediaShiftDistance","clientWidth","textShiftDistance","mediaShift","textShift","opacityShift","transform","opacity","shiftSlides","minTimer","Promise","res","setTimeout","addFormEvents","formEl","showFormButtons","hideFormButtons","showForm","focus","hideForm","map","e","target","currentTarget","select","selectValue","value","options","selectedIndex","innerHTML","form","preventDefault","all","sources","slideVideos","s","src","getAttribute","loadVideos","load","race","then","loadMedia","finally","plans","header","clientHeight","headerTheming","pageMedia","slidesMedia","concat","videoPlayback","setInterval"],"mappings":"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"}